generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String        @id @default(cuid())
  email          String        @unique
  passwordHash   String
  name           String
  phone          String?
  role           Role          @default(OWNER)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  title          String?
  address        String?
  country        String?       @default("Nigeria")
  state          String?
  emergencyName  String?
  emergencyPhone String?
  activityLogs   ActivityLog[]
  ownedHorses    Ownership[]
}

model Horse {
  id                   String          @id @default(cuid())
  name                 String
  breed                String?
  color                String?
  sex                  Sex?
  microchip            String?         @unique
  imageUrl             String?
  status               HorseStatus     @default(ACTIVE)
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  allergies            String?
  behavior             String?
  bloodType            String?
  bodyConditionScore   Float?
  countryOfBirth       String?         @default("Nigeria")
  currentMedications   String?
  dam                  String?
  dietary              String?
  dob                  DateTime?
  exerciseRestrictions String?
  insurance            String?
  lastDeworming        DateTime?
  sire                 String?
  weight               Float?
  activityLogs         ActivityLog[]
  documents            Document[]
  medicalRecords       MedicalRecord[]
  owners               Ownership[]
  vaccinations         Vaccination[]
}

model Ownership {
  id        String    @id @default(cuid())
  horseId   String
  ownerId   String
  startDate DateTime  @default(now())
  endDate   DateTime?
  horse     Horse     @relation(fields: [horseId], references: [id], onDelete: Cascade)
  owner     User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@unique([horseId, ownerId])
}

model MedicalRecord {
  id          String   @id @default(cuid())
  horseId     String
  diagnosis   String
  treatment   String
  notes       String?
  attachments String[]
  recordDate  DateTime @default(now())
  createdAt   DateTime @default(now())
  dosage      String?
  drug        String?
  vet         String?
  horse       Horse    @relation(fields: [horseId], references: [id], onDelete: Cascade)
}

model Vaccination {
  id             String   @id @default(cuid())
  horseId        String
  vaccineName    String
  dateGiven      DateTime
  nextDue        DateTime
  batchNumber    String?
  notes          String?
  createdAt      DateTime @default(now())
  administeredBy String?
  certificateNo  String?
  horse          Horse    @relation(fields: [horseId], references: [id], onDelete: Cascade)
}

model Document {
  id          String       @id @default(cuid())
  horseId     String?
  type        DocumentType
  passportNo  String?      @unique
  fileUrl     String
  fingerprint String
  metadata    Json?
  createdAt   DateTime     @default(now())
  horse       Horse?       @relation(fields: [horseId], references: [id], onDelete: Cascade)
}

model SealAsset {
  id          String   @id @default(cuid())
  type        SealType
  pngUrl      String
  svgUrl      String?
  fingerprint String
  metadata    Json?
  createdAt   DateTime @default(now())
  isActive    Boolean  @default(true)
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String?
  horseId   String?
  action    String
  details   String?
  createdAt DateTime @default(now())
  horse     Horse?   @relation(fields: [horseId], references: [id])
  user      User?    @relation(fields: [userId], references: [id])
}

enum Role {
  VET
  OWNER
}

enum Sex {
  STALLION
  MARE
  GELDING
}

enum HorseStatus {
  ACTIVE
  RETIRED
  DECEASED
}

enum DocumentType {
  PASSPORT
  AUTHENTICATION_SEAL
  MEDICAL_REPORT
}

enum SealType {
  CIRCULAR
  EMBLEM
  WAX
  SIGNATURE_OVERLAY
}
